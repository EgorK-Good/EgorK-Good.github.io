<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Mini Game</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-particle-system-component@1.0.2/dist/aframe-particle-system-component.min.js"></script>
  </head>
  <body>

    <a-scene>
      <!-- Освещение -->
      <a-light type="ambient" color="#bbb"></a-light>
      <a-light type="directional" color="#fff" intensity="0.6" position="-1 1 0"></a-light>

      <!-- Небо -->
      <a-sky src=sky.png></a-sky>

      <!-- Пол с текстурой -->
      <a-plane position="0 0 -4" rotation="-90 0 0" width="100" height="100" src=ret.png" shadow="receive: true"></a-plane>

      <!-- Камера и контроллер -->
      <a-entity camera look-controls wasd-controls position="0 1.6 0">
        <a-cursor color="black" fuse="true" fuse-timeout="500"></a-cursor>
      </a-entity>
      <a-entity id="leftHand" hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"></a-entity>
      <a-entity id="rightHand" hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc"></a-entity>

      <!-- Объекты для сбора с текстурами -->
      <a-box position="-6 1 -3" width="1" height="1" depth="1" src="https://aframe.io/aframe/examples/test/textures/brick.jpg" collectible shadow="cast: true"></a-box>
      <a-box position="5 1 -2" width="1" height="1" depth="1" src="https://aframe.io/aframe/examples/test/textures/brick.jpg" collectible shadow="cast: true"></a-box>
      <a-box position="-7 1 -1" width="1" height="1" depth="1" src="https://aframe.io/aframe/examples/test/textures/brick.jpg" collectible shadow="cast: true"></a-box>
      <a-box position="8 1 -3" width="1" height="1" depth="1" src="https://aframe.io/aframe/examples/test/textures/brick.jpg" collectible shadow="cast: true"></a-box>
      <a-box position="-1 1 -3" width="1" height="1" depth="1" src="https://aframe.io/aframe/examples/test/textures/brick.jpg" collectible shadow="cast: true"></a-box>
      <a-box position="-2 1 -4" width="1" height="1" depth="1" src="https://aframe.io/aframe/examples/test/textures/brick.jpg" collectible shadow="cast: true"></a-box>

      <!-- Текст для отображения счета -->
      <a-text id="score" value="Score: 0" position="-1.5 2.5 -5" color="black"></a-text>

      <!-- Таймер -->
      <a-text id="timer" value="Time: 30" position="1.5 2.5 -5" color="black"></a-text>

      <!-- Текст для окончания игры -->
      <a-text id="gameOverText" value="" position="-1 4 -4" color="black"></a-text>

      <!-- Звук при сборе объекта -->
      <a-sound id="collectSound" src="https://cdn.aframe.io/examples/sounds/click.ogg" autoplay="false"></a-sound>
    </a-scene>

    <script>
        // Логика сбора объектов
        AFRAME.registerComponent('collectible', {
            init: function () {
                this.el.addEventListener('click', () => {
                    // Получение позиции объекта
                    const position = this.el.getAttribute('position');

                    // Создание частиц разрушения
                    const particles = document.createElement('a-entity');
                    particles.setAttribute('particle-system', {
                        preset: 'custom',
                        particleCount: 100,
                        color: '#4CC3D9',
                        duration: 1,
                        size: 0.1,
                        velocityValue: '0 5 0',
                        velocitySpread: '5 5 5',
                        positionSpread: '0.5 0.5 0.5',
                        texture: 'url(https://aframe.io/aframe/examples/boilerplate/particles/particle.png)'
                    });
                    particles.setAttribute('position', position);
                    this.el.parentNode.appendChild(particles);

                    // Удаление объекта из сцены
                    this.el.parentNode.removeChild(this.el);

                    // Обновление счета
                    let scoreElement = document.querySelector('#score');
                    let score = parseInt(scoreElement.getAttribute('value').split(': ')[1]) + 1;
                    scoreElement.setAttribute('value', 'Score: ' + score);

                    // Воспроизведение звука
                    const sound = document.querySelector('#collectSound');
                    sound.components.sound.playSound();
                });
            }
        });

        let timeLeft = 30; // Время игры в секундах
        let timerElement = document.querySelector('#timer');

        function updateTimer() {
            if (timeLeft > 0) {
                timeLeft--;
                timerElement.setAttribute('value', 'Time: ' + timeLeft);
            } else {
                endGame();
            }
        }

        setInterval(updateTimer, 1000);

        function endGame() {
            let finalScore = parseInt(document.querySelector('#score').getAttribute('value').split(': ')[1]);
            let gameOverText = document.querySelector('#gameOverText');
            gameOverText.setAttribute('value', 'Game Over! Your final score is: ' + finalScore);

            // Перезапуск игры (можно убрать, если не нужно)
            // location.reload();
        }
    </script>
  </body>
</html>
